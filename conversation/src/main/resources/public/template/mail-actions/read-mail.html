<!-- read from inbox -->
<div class="twelve cell">
	<div class="row">
		<plus class="right-magnet">
			<button ng-click="replyAll()" ng-disabled="!mail.allowReplyAll"><i18n>replyall</i18n></button>
			<button ng-click="transfer()"><i18n>transfer</i18n></button>
			<a class="button"   target="_blank" ng-href="/conversation/print#/printMail/[[mail.id]]"><i18n>print</i18n></a>
			<button ng-click="removeMail()"><i18n>remove</i18n></button>
		</plus>
		<!-- Reply not allowed if deleted user -->
		<button class="right-magnet" ng-click="reply()" ng-disabled="!mail.allowReply">
			<i18n>reply</i18n>
		</button>

<nav class="prev-next" ng-if="state.current.count > 1">
	<button class="" ng-click="previousMail()" ng-disabled="conversation.currentFolder.mails.all.indexOf(state.current) === 0">
		<i class="left-open"></i>
	</button>
	<span class="pagination">
		<span>[[conversation.currentFolder.mails.all.indexOf(state.current)+1]]</span>
		<i18n class="zero-mobile">mail.count.of</i18n>
		<span class="zero-desktop">/</span>
		<span> [[state.current.count]]</span>
	</span>
	<button class="" ng-click="nextMail()" ng-disabled="conversation.currentFolder.mails.all.indexOf(state.current) + 1 === state.current.count">
		<i class="open-right"></i>
	</button>
</nav>

	</div>

	<article class="twelve cell vertical-spacing mail">
		<div class="row">
			<em class="cell small-text right-magnet">
				[[mail.sentDate()]]
			</em>
			<div class="row">
				<div class="text-title">[[mail.subject]]</div>
			</div>
			<h5 class="row" ng-if="mail.response">
				<em class="indication"><i class="undo"></i><i18n>you.answered</i18n></em>
			</h5>
			<hr />

			<div class="flex-row align-center medium-importance medium-text">

				<div class="avatar">
					<img ng-src="/userbook/avatar/[[mail.from]]?thumbnail=100x100"/>
				</div>

				<div class="horizontal-spacing-twice">
					<!-- from -->
					<strong><span translate key="from"></span>
					<span> : </span></strong>
					<a href="/userbook/annuaire#[[mail.sender().id]]">[[mail.sender().displayName]]</a>

					<!-- to -->
					<div>
						<span translate key="to"></span>
						<span> : </span>

						<span ng-repeat="receiver in receivers = (mail.to | filter: filterUsers(mail))">
							<!-- attention remove me from receiver links -->
							<!-- span si c'est moi même -->
							<!-- span si c'est group -->
							<!-- <a> si c'est des users -->

							<a ng-if="!users.list.isGroup(mail.map(receiver).id)" href="/userbook/annuaire#[[mail.map(receiver).id]]">[[receiver.displayName]]</a>
							<span ng-if="$index !== receivers.length - 1 && receiver.displayName">,</span>

						</span>
						<span ng-repeat="receiverName in mail.toName">
							[[receiverName]]<span ng-if="$index !== mail.toName.length - 1">,</span>
						</span>
					</div>

					<!-- copies -->
					<div ng-if="(mail.cc.length + mail.ccName.length) > 0">
						<span translate key="cc"></span>
						<span> : </span>

						<span ng-repeat="receiver in receivers = (mail.cc | filter: filterUsers(mail))">
							<!-- attention remove me from receiver links -->
							<!-- span si c'est moi même -->
							<!-- span si c'est group -->
							<!-- <a> si c'est des users -->
							<a ng-if="!users.list.isGroup(mail.map(receiver).id)" href="/userbook/annuaire#[[mail.map(receiver).id]]">[[receiver.displayName]]</a>
							<span ng-if="users.list.isGroup(mail.map(receiver).id)">[[mail.map(receiver).displayName]]</span>

							<span ng-if="$index !== receivers.length - 1 && receiver.displayName">,</span>
						</span>
						<span ng-repeat="receiverName in mail.ccName">
							[[receiverName]]<span ng-if="$index !== mail.ccName.length - 1">,</span>
						</span>
					</div>

				</div>

			</div>

			<hr />
			<div class="row">
				<div class="twelve cell escape_cke" bind-html="mail.body"></div>
			</div>
			<hr />
		</div>

		
		<div class="row block-container medium-text" ng-if="mail.attachments && mail.attachments.length > 0" ng-init="columnOrder = 'filename'">
			<p>
				<h2>
					<i18n>attachments</i18n>
					<a  data-ng-if="mail.attachments.length > 1" class="" ng-href="[['message/'+mail.id+'/allAttachments']]"><i class="mail-in" ></i></a>
				</h2>
			</p>
			<article class="list-view">
				<table class="list-view">
					<thead>
					<th colspan="4"></th>
					</thead>
					<tbody>
					<tr ng-repeat="attachment in mail.attachments | orderBy: columnOrder" class="element">
						<td class="icon">
							<div class="twelve cell">
								<i class="[[formatFileType(attachment.contentType)]]"></i>
							</div>
						</td>
						<td>
							<a ng-href="[['message/'+mail.id+'/attachment/'+attachment.id]]">
								[[attachment.filename]]
							</a>
						</td>
						<td>
							[[formatSize(attachment.size)]]
						</td>
						<td>
							<i class="remove-small center"
							   ng-click="deleteAttachment($event, attachment, mail)"
							   tooltip="remove.attachment">
							</i>
						</td>
					</tr>
					</tbody>
				</table>
			</article>
		</div>
	</article>
</div>
